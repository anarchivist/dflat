<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head>
<title>Repository Working Group: Reverse Directory Deltas (ReDD)</title>
<meta http-equiv="Expires" content="Wed, 24 Jun 2009 09:23:39 +0000">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="Reverse Directory Deltas (ReDD)">
<meta name="generator" content="xml2rfc v1.32 (http://xml.resource.org/)">
<style type="text/css"><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head><body>
<table summary="layout" border="0" cellpadding="0" cellspacing="0" width="66%"><tbody><tr><td><table summary="layout" border="0" cellpadding="2" cellspacing="1" width="100%">
<tbody><tr><td class="header">Repository Working Group</td><td class="header">J. Kunze</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">S. Abrams</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Hetzner</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">D. Loy</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">California Digital Library</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 23, 2009</td></tr>
</tbody></table></td></tr></tbody></table>
<h1><br>Reverse Directory Deltas (ReDD)</h1>

<h3>Abstract</h3>

<p>
ReDD is a "reverse delta" scheme that permits the reconstruction of an
earlier version of a set of files starting from a given full set of files.
In a chain of ReDD version deltas, access to prior version
<em>N-M</em> starting from version
<em>N</em>
requires the sequential reconstruction of versions
<em>N-1</em>,
<em>N-2</em>, ...,
<em>N-M</em>,
so the later the version the faster the access.  Because later versions
don't depend on earlier versions, the old part of a chain broken at an
arbitrary point can be discarded without adjustment to the remainder of
the chain.  Any ReDD version can also be represented with a full set of 
files rather than with deltas, which may be useful for caching recently
reconstructed versions or for establishing points of departure for runs
of deltas.  Typically, full file sets occur in the latest version at the
head of a chain and in any versions that serve as checkpoints or cover
interior modifications of the original version chain.

</p>
<a name="anchor1"></a><br><hr>
<a name="rfc.section.1"></a><h3>1.&nbsp;
The multiple versions problem</h3>

<p>
Keeping multiple versions of a set of digital files can be costly if each
version is stored in full.  If differences between versions tend to be
small, however, it can make sense to compress a chain of versions by
storing a full set of files once and recording only the changes, or
"deltas", thereafter.  For instance, with multiple versions of a set of
80 image and text files, one of which holds metadata that changes 5 times
a year, keeping just the changed files over the course of a year requires
maintaining only 85 files instead of 400 files.

</p>
<p>
The trouble is access.  The file set in a compressed version is no longer
ready-to-go, but must first be reconstructed according to the deltas.
Making reconstruction simple and understandable might sacrifice some
storage savings, but that may be worthwhile in digital library settings
where reliability, transparency, and platform-independence are also
important.  An especially simple approach is to use file-level deltas
as opposed to subfile-level deltas (e.g., Unix
<tt>diff</tt> and <tt>patch</tt>).
For file-level deltas, reconstructing a set of files that comprises a
generic digital object can be thought of as a sequence of file deletion
instructions followed by a sequence of file addition instructions.

</p>
<a name="anchor2"></a><br><hr>
<a name="rfc.section.2"></a><h3>2.&nbsp;
ReDD home directory</h3>

<p>
ReDD (Reverse Directory Deltas) is a scheme for representing the
differences between a given full set of files and a previous version of
that set.  Differences are called "reverse deltas" because they revert
a version, <em>N</em>, to a previous version,
<em>N-1</em>.  The advantage of this inversion is that
the most recent version is always ready-to-go and reconstruction costs
are incurred only for what are typically uncommon access patterns (to
older versions).

</p>
<p>
A <em>ReDD home</em> is a directory that holds ReDD
deltas.  It represents a compressed version using essentially two
reserved names.  In the example below, deltas specify the deletion of two
files and the addition of one file in order to construct the previous
version (lines of file content are shown in parentheses beneath the file
name).

</p>
<div style="display: table; width: 0pt; margin-left: 3em; margin-right: auto;"><pre>&lt;redd_home&gt;
 |   0=redd_0.1        # declaration that this is a ReDD directory
 |   delete.txt        # delete these in creating previous version
 |    (data/27613-h/images/q172.png)     # to delete from current
 |    (data/27613-h/images/q172.txt)     # to delete from current
 |
 \--- add/             # add these, with paths, in creating previous
       |   admin/conformance.xml         # to add to current
</pre></div><p>


</p>
<p>
Here, the special file named <tt>0=redd_0.1</tt>
(a name-as-text tag file <a class="info" href="#Namaste">[Namaste]<span> (</span><span class="info">Kunze, J., “Directory Description with Namaste Tags,” April&nbsp;2009.</span><span>)</span></a>) identifies the type
of this directory to be "ReDD 0.1".  The implementor may choose
any name for the ReDD home directory.

</p>
<p>
Version differences are expressed via the text file,
<tt>delete.txt</tt>,
which lists filesystem paths to be deleted, and the directory,
<tt>add/</tt>,
which contains files to be added (with paths intact).  Applying the
changes to a full copy of the current version constructs the previous
version.

</p>
<a name="anchor3"></a><br><hr>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Version chains</h3>

<p>
The application of deltas requires a fully instantiated version to start
with, in particular, at the head of a chain of version deltas.  The same
holds inside the chain, where the immediately preceding version must
be fully instantiated, and this can imply reconstruction of all preceding
versions back to the head of the chain.  Here's ReDD in the context of a
"digital flat" <a class="info" href="#Dflat">[Dflat]<span> (</span><span class="info">, “Dflat: Simple File-Based Object Storage,” April&nbsp;2009.</span><span>)</span></a>; this example shows the current
version and three previous versions.

</p>
<div style="display: table; width: 0pt; margin-left: 3em; margin-right: auto;"><pre>&lt;dflat_home&gt;          # Best to read this example from the bottom up.
 |   0=dflat_0.7                   # I am a "digital flat"
 |--- v007/                        # tail (oldest) in version chain
 |     \--- redd/
 |           |   0=redd_0.1
 |           |   delete.txt
 |           |    (data/thumbnail.png)   # delete in 8-&gt;7 (add in 7-&gt;8)
 |           |    (enrichment/meta.xml)  # replace in 8-&gt;7
 |           \--- add/
 |                 \--- enrichment/
 |                       |   meta.xml
 |--- v008/
 |     \--- redd/
 |           |   0=redd_0.1
 |           |   delete.txt
 |           |    (enrichment/meta.xml)  # replace in 9-&gt;8
 |           \--- add/
 |                 \--- enrichment/
 |                       |   meta.xml
 |--- v009/
 |     \--- redd/
 |           |   0=redd_0.1
 |           |   delete.txt
 |           |    (enrichment/meta.xml)  # replace in going from 10-&gt;9
 |           \--- add/
 |                 \--- enrichment/
 |                       |   meta.xml
 \--- v010/                        # head (latest) in version chain
       \--- full/
             |--- data/ ...
             \--- enrichment/ ...
</pre></div><p>


ReDD has no concept of version numbers or chains.  It is Dflat in this
example that is used to represent a chain of four versions with version
10 at its head.  Examining this particular chain, one may observe a
common versioning pattern in which the full set of files is more stable
than its metadata.  To reconstruct a version does require the presence of
a fully instantiated version, but ReDD does not specify where it resides.

</p>
<p>
To create version 9, for example, the
<tt>enrichment/meta.xml</tt> file is replaced (first
deleted, then an older file re-added).  The same metadata replacement
occurs in constructing versions 8 and 7.  It is in going to version 7,
however, that a file needs to be deleted.  This is an image file present
in version 8 but absent in version 7.  It was originally added in going
from 7 to 8, so it has to be deleted going from 8 to 7.

</p>
<a name="anchor4"></a><br><hr>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Applying ReDD differences</h3>

<p>
If construction of the previous version is desired, first one needs a
full copy of the current version.  Starting with the current version,
the <tt>delete.txt</tt> file is a list of files and
directories that need to be deleted to create the previous version.
Entries are listed one per line, with a directory entry distinguished
from a file entry by a terminal '/' character (useful since files and
directories are often removed with different commands).  It is likely an
error if, before deletion, any file or directory listed in
<tt>delete.txt</tt> does not exist.

</p>
<p>
After all entries in <tt>delete.txt</tt>
have been deleted, construction of the previous version will be complete
after all items in <tt>add/</tt>
been added.  It can be a little confusing, because the ReDD 'delete' and
'add' operations that create the previous version are precisely the
inverse of those by which the current version originally evolved from the
earlier version.

</p>
<p>
Here's a summary of the two-step process to go from a copy of the fully
instantiated set of files in the current version to a fully instantiated
set of files in the previous version.

</p>
<ol class="text">
<li>
If <tt>delete.txt</tt> is present, delete all file and
directory entries found in this file.  It is an error if, before
deletion, any file or directory listed in this file does not exist.

</li>
<li>
Finally, if the <tt>add/</tt> directory is present,
bring in copies of all files and directories found under it.

</li>
</ol><p>
When done, the previous version (the target of this version
reconstruction) should now be complete.

</p>
<a name="rfc.references1"></a><br><hr>
<h3>5.&nbsp;References</h3>
<table border="0" width="99%">
<tbody><tr><td class="author-text" valign="top"><a name="Dflat">[Dflat]</a></td>
<td class="author-text">“<a href="http://www.cdlib.org/inside/diglib/dflat/dflat.pdf">Dflat: Simple File-Based Object Storage</a>,” April&nbsp;2009 (<a href="http://www.cdlib.org/inside/diglib/dflat/dflat.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Namaste">[Namaste]</a></td>
<td class="author-text">Kunze, J., “<a href="http://www.cdlib.org/inside/diglib/namaste/namastespec.html">Directory Description with Namaste Tags</a>,” April&nbsp;2009 (<a href="http://www.cdlib.org/inside/diglib/namaste/namastespec.html">HTML</a>).</td></tr>
</tbody></table>

<a name="rfc.authors"></a><br><hr>
<h3>Authors' Addresses</h3>
<table border="0" cellpadding="0" cellspacing="0" width="99%">
<tbody><tr><td class="author-text">&nbsp;</td>
<td class="author-text">John A. Kunze</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">California Digital Library</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">415 20th St, 4th Floor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oakland, CA  94612</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 510-893-5212</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jak@ucop.edu">jak@ucop.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephen Abrams</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">California Digital Library</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">415 20th St, 4th Floor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oakland, CA  94612</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 510-893-5212</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stephen.abrams@ucop.edu">stephen.abrams@ucop.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Erik Hetzner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">California Digital Library</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">415 20th St, 4th Floor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oakland, CA  94612</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 510-893-5212</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:erik.hetzner@ucop.edu">erik.hetzner@ucop.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">David Loy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">California Digital Library</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">415 20th St, 4th Floor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oakland, CA  94612</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 510-893-5212</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:david.loy@ucop.edu">david.loy@ucop.edu</a></td></tr>
</tbody></table>
</body></html>
